Plug 'ReplaceWithRegister'
Plug 'vim-commentary'
Plug 'vim-surround'
" https://github.com/JetBrains/ideavim/wiki/NERDTree-support
Plug 'nerdtree'

" don't hide error if there is a bug in IdeaVim
" https://github.com/JetBrains/ideavim/discussions/303#discussioncomment-655607
set ideastrictmode
set number
set relativenumber
set hlsearch
set smartcase
set ignorecase
" use system clipboard
set clipboard=unnamed,ideaput
" stay in normal mode when triggering RenameElement action
" https://github.com/JetBrains/ideavim/wiki/set-commands
set idearefactormode=keep

nnoremap <leader>ev :edit ~/.ideavimrc<cr>
nnoremap <leader>sv :w <bar> action IdeaVim.ReloadVimRc.reload <bar> echo "~/.ideavimrc sourced"<cr>
" track actions
map <leader>tv <Action>(VimFindActionIdAction)

imap jk <esc>
" revert Y to standard vim behavior
nnoremap Y y$

" Window management
map <leader>ww <Action>(MaximizeEditorInSplit)
map <leader>wo <Action>(CloseAllEditorsButActive)
map <leader>ca <Action>(ToggleDistractionFreeMode)
map <leader>cz <Action>(HideAllWindows)
map <space>; <Action>(JumpToLastWindow)
nnoremap <leader><leader> <c-6>
nnoremap [r :tabprevious<cr>
nnoremap ]r :tabnext<cr>
nnoremap <space>h <c-w>h
nnoremap <space>l <c-w>l
map <space>q <Action>(CloseContent)
" close split
map <leader>qq <Action>(CloseAllEditors)
map <c-w>H <Action>(MoveEditorToOppositeTabGroup)
map <c-w>L <Action>(MoveEditorToOppositeTabGroup)
map <space>, <Action>(StretchSplitToLeft)
map <space>. <Action>(StretchSplitToRight)
" make splits have the same size
function! WinEq() abort
  action MaximizeEditorInSplit
  action MaximizeEditorInSplit
endfunction
map <c-w>= :call WinEq()<cr>

" Search
map <space>o <Action>(GotoFile)
map <space>[ <Action>(GotoClass)
map <space>] <Action>(GotoSymbol)
map <space>a <Action>(FindInPath)
nmap [q <Action>(PreviousOccurence)
nmap ]q <Action>(NextOccurence)
nnoremap gh :nohlsearch<cr>

" Code navigation
nmap <c-o> <Action>(Back)
nmap <c-i> <Action>(Forward)
map <space>e <Action>(GotoDeclaration)
map <leader>ge <Action>(FindUsages)
map <leader>gi <Action>(GotoImplementation)
map <leader>dk <Action>(ShowErrorDescription)
" show file in Project view (use 'q' to close Project view)
nnoremap - :NERDTree<cr>
nnoremap <leader>tq :NERDTreeClose<cr>
map <leader>et <Action>(GotoTest)

function! ToggleRelativeNumber() abort
  if &relativenumber
    set norelativenumber
  else
    set relativenumber
  endif
endfunction
nnoremap con :call ToggleRelativeNumber()<cr>

" folding
map <tab> <Action>(CollapseRegion)
map <s-tab> <Action>(ExpandRegion)

" git blame
map <leader>gb <Action>(Annotate)
" open current line in GitHub, GitLab, etc. (via GitLink plugin)
map <leader>gh <Action>(uk.co.ben_gibson.git.link.ui.actions.menu.BrowserAction)

" Text editing
map <leader>gp <Action>(ReformatCode)
map <leader>re <Action>(RenameElement)
nnoremap =p o<esc>p
map [e <Action>(MoveLineUp)
map ]e <Action>(MoveLineDown)

" Run last test
map <space>t <Action>(Run)
" Run test under cursor
map <leader>st <Action>(RunClass)

" edit common files
nnoremap <leader>ew :edit ~/Google Drive/My Drive/notes-work/work-buffer.txt<cr>
